<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<link rel="stylesheet" href="style.css">
<style>
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #70c5ce;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    display: block;
    touch-action: manipulation;
  }
  #gameOverOverlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.6);
    color: #fff;
    text-align: center;
    padding: 20px;
    border-radius: 10px;
    visibility: hidden;
    font-family: Arial, sans-serif;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="gameOverOverlay">
  <p id="gameOverTitle">GAME OVER</p>
  <p id="gameOverScore">Score: 0</p>
  <p id="gameOverHigh">High Score: 0</p>
  <p>Tap / Click to Restart</p>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("gameOverOverlay");
const scoreText = document.getElementById("gameOverScore");
const highText = document.getElementById("gameOverHigh");

const GAME_WIDTH = 288;
const GAME_HEIGHT = 512;

// Scale canvas for mobile screens
function resizeCanvas() {
  const ratio = window.devicePixelRatio || 1;
  canvas.width = GAME_WIDTH * ratio;
  canvas.height = GAME_HEIGHT * ratio;
  canvas.style.width = GAME_WIDTH + "px";
  canvas.style.height = GAME_HEIGHT + "px";
  ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

let frames = 0;
let score = 0;
let highScore = localStorage.getItem("flappyHighScore") || 0;
let running = true;
const groundHeight = 112;

// Assets
const bg = new Image(); bg.src = "img/bg.png";
const ground = new Image(); ground.src = "img/ground.png";
const birdFrames = [new Image(), new Image(), new Image()];
birdFrames[0].src = "img/bird1.png";
birdFrames[1].src = "img/bird2.png";
birdFrames[2].src = "img/bird3.png";
const pipeTop = new Image(); pipeTop.src = "img/pipe.png";
const pipeBottom = new Image(); pipeBottom.src = "img/pipe.png";

// Sounds
const flapSound = new Audio("sounds/gawwk.MP3");
const hitSound = new Audio("sounds/0919.MP3");

// Wait for assets
let assetsLoaded = 0;
const totalAssets = 8;
function assetLoaded() {
  assetsLoaded++;
  if (assetsLoaded === totalAssets) loop();
}
[bg, ground, pipeTop, pipeBottom, ...birdFrames].forEach(img => img.onload = assetLoaded);
[flapSound, hitSound].forEach(audio => audio.oncanplaythrough = assetLoaded);

// Bird
const bird = {
  x: 50, y: 200, w: 34, h: 24,
  frame: 0, velocity: 0, gravity: 0.25, jump: 4.5, alive: false, rotation: 0,
  draw() {
    ctx.save();
    ctx.translate(this.x + this.w/2, this.y + this.h/2);
    ctx.rotate(this.rotation);
    ctx.drawImage(birdFrames[this.frame], -this.w/2, -this.h/2);
    ctx.restore();
  },
  flap() {
    this.velocity = -this.jump;
    this.alive = true;
    try { flapSound.play(); } catch(e) {}
  },
  update() {
    this.frame = (frames % 9) / 3 | 0;
    if (!this.alive && running) return;

    this.velocity += this.gravity;
    this.y += this.velocity;

    // Smooth rotation
    if (this.velocity < 0) this.rotation = -0.3;
    else this.rotation += (Math.PI/2 - this.rotation) * 0.05;

    // Ground collision
    if (this.y + this.h >= GAME_HEIGHT - groundHeight) {
      this.y = GAME_HEIGHT - groundHeight - this.h;
      triggerGameOver();
    }

    if (this.y < 0) this.y = 0;
  }
};

// Pipes
const pipes = [];
const pipeGap = 120;
const pipeWidth = 52;

function spawnPipe() { 
  pipes.push({ x: GAME_WIDTH, y: -Math.random()*100-50, scored: false }); 
}

function drawPipes() { 
  pipes.forEach(p => { 
    ctx.drawImage(pipeTop, p.x, p.y); 
    ctx.drawImage(pipeBottom, p.x, p.y + pipeTop.height + pipeGap); 
  }); 
}

function updatePipes() {
  if (!bird.alive) return;
  pipes.forEach(p => {
    p.x -= 2; // slightly faster
    if (!p.scored && p.x + pipeWidth < bird.x) {
      score++; 
      p.scored = true;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("flappyHighScore", highScore);
      }
    }
    if (
      bird.x + bird.w > p.x &&
      bird.x < p.x + pipeWidth &&
      (bird.y < p.y + pipeTop.height || bird.y + bird.h > p.y + pipeTop.height + pipeGap)
    ) {
      triggerGameOver();
    }
  });
  if (frames % 100 === 0) spawnPipe();
}

// Ground
let groundX = 0;
function drawGround() {
  if (bird.alive) groundX = (groundX - 2) % (ground.width/2);
  ctx.drawImage(ground, groundX, GAME_HEIGHT - ground.height);
  ctx.drawImage(ground, groundX + ground.width, GAME_HEIGHT - ground.height);
}

// Trigger Game Over
function triggerGameOver() {
  if (!running) return;
  running = false;
  bird.alive = false;

  try { hitSound.currentTime = 0; hitSound.play(); } catch(e) {}

  hitSound.onended = () => {
    scoreText.textContent = "Score: " + score;
    highText.textContent = "High Score: " + highScore;
    overlay.style.visibility = "visible";
  };
}

// Game Loop
function loop() {
  ctx.drawImage(bg, 0, 0);
  bird.update();
  bird.draw();
  updatePipes();
  drawPipes();
  drawGround();
  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 25);
  ctx.fillText("High: " + highScore, 10, 50);
  frames++;
  requestAnimationFrame(loop);
}

// Controls
document.addEventListener("keydown", e => { if (e.code === "Space") bird.flap(); });
canvas.addEventListener("mousedown", () => { if (!running) location.reload(); else bird.flap(); });
canvas.addEventListener("touchstart", () => { if (!running) location.reload(); else bird.flap(); });
</script>
</body>
</html>
